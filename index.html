<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART SWALAYAN - LOGIN</title>
    <style>
        /* ... (CSS ASLI TETAP SAMA) ... */
    </style>
</head>
<body>
    <div class="container">
        <form id="loginForm">
            <div class="input-group">
                <label for="tokoSelect"><i class="fas fa-store"></i> Pilih Toko</label>
                <select id="tokoSelect" required>
                    </select>
            </div>
            
            <p id="message" class="message"></p>
        </form>
        
        </div>

    <script>
        // --- PENTING: GANTI DENGAN URL APPS SCRIPT ANDA ---
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwFhXRPAFqMgkweuIBuM1jZFq6Vj_AJ_kk4XIsdJk0-iEPF6oST5wmbELUrS0bMhqlKiw/exec';
        // --- DAFTAR TOKO HARDCODE (HARUS SINKRON DENGAN SHEET 'TOKO') ---
        const LIST_TOKO_HARDCODE = [
            "SMART SWALAYAN BIMA", 
            "DEPO TENTE", 
            
            // Tambahkan toko baru di sini
        ];
        // --- AKHIR PENTING ---

        const LOGIN_FORM = document.getElementById('loginForm');
        const TOKO_SELECT = document.getElementById('tokoSelect');
        const MESSAGE_ELEMENT = document.getElementById('message');
        
        // ... (Fungsi displayMessage dan sendApiRequest TETAP SAMA) ...

        async function sendApiRequest(action, data = {}) {
            // ... (Fungsi ini tetap sama) ...
            const payload = { action, ...data };
            const cacheBuster = `?t=${new Date().getTime()}`; 
            const targetUrl = GAS_API_URL + cacheBuster; 
            const bodyData = new URLSearchParams(payload).toString();

            try {
                const response = await fetch(targetUrl, { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, 
                    body: bodyData
                });

                if (!response.ok) {
                    throw new Error(`Permintaan API Gagal. Status: ${response.status}`);
                }
                
                const responseText = await response.text();
                
                try {
                    const responseData = JSON.parse(responseText);

                    if (responseData.status === 'error') {
                        throw new Error(responseData.message); 
                    }

                    return responseData;
                    
                } catch (e) {
                     console.error("Gagal parse JSON. Respons dari Apps Script:", responseText);
                     throw new Error('Respons Apps Script tidak valid. Cek izin/otorisasi Apps Script.');
                }
                
            } catch (error) {
                console.error("API Request Failed:", error);
                throw new Error(error.message || 'Koneksi Apps Script Gagal. Cek Jaringan/URL.');
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            // 1. HARDCODE PEMUATAN DAFTAR TOKO (INSTANT)
            TOKO_SELECT.innerHTML = '<option value="" disabled selected>-- Pilih Toko Anda --</option>';
            LIST_TOKO_HARDCODE.forEach(toko => {
                const option = document.createElement('option');
                option.value = toko;
                option.textContent = toko;
                TOKO_SELECT.appendChild(option);
            });
            // HAPUS LOGIKA ASLI getTokoList()
            
            // ... (Handler Login TETAP SAMA) ...
            
            LOGIN_FORM.addEventListener('submit', async (e) => {
                // ... (Logika form submit TETAP SAMA) ...
            });

            // ... (Handler Daftar dan Copyright TETAP SAMA) ...
        });
    </script>
</body>
</html>
